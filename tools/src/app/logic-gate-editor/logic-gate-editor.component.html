<div class="logic-gate-editor-container">
  <div class="palette">
    <h3>Logic Gates</h3>
    <div
        class="gate-icon"
        [class.selected]="selectedGateType === 'AND'"
        (click)="selectGateType('AND')"
    >
      AND
    </div>
    <div
        class="gate-icon"
        [class.selected]="selectedGateType === 'OR'"
        (click)="selectGateType('OR')"
    >
      OR
    </div>
    <div
        class="gate-icon"
        [class.selected]="selectedGateType === 'NOT'"
        (click)="selectGateType('NOT')"
    >
      NOT
    </div>
    <!-- Add more gate types as needed -->
  </div>
  <div class="canvas-area">
    <svg class="drawing-canvas" width="800" height="600" (click)="onCanvasClick($event)">
      <!-- Existing gate rendering -->
      <g *ngFor="let gate of gates"
         [attr.transform]="'translate(' + gate.x + ',' + gate.y + ')'"
         [attr.data-gate-id]="gate.id"
         (mousedown)="startDrag(gate, $event)">
        <!-- Render gate symbol based on type -->
        <ng-container [ngSwitch]="gate.type">
          <g *ngSwitchCase="'AND'">
            <path d="M0,0 L20,0 A20,20 0 0,1 20,40 L0,40 Z" fill="lightblue" stroke="black"/>
            <line x1="0" y1="0" x2="0" y2="40" stroke="black"/>
          </g>
          <g *ngSwitchCase="'OR'">
            <path d="M0,0 C10,10 10,30 0,40 C15,35 25,25 25,20 C25,15 15,5 0,0 Z" fill="lightgreen" stroke="black"/>
          </g>
          <g *ngSwitchCase="'NOT'">
            <polygon points="0,0 20,20 0,40" fill="lightcoral" stroke="black"/>
            <circle cx="23" cy="20" r="3" fill="white" stroke="black"/>
          </g>
        </ng-container>

        <!-- Render Input Ports -->
        <circle *ngFor="let input of gate.inputs"
                [attr.cx]="input.x"
                [attr.cy]="input.y"
                r="3"
                fill="white"
                stroke="black"
                class="gate-port input-port"
                [attr.data-port-id]="input.id"
                (click)="startWire(gate, input, $event)">
        </circle>

        <!-- Render Output Ports -->
        <circle *ngFor="let output of gate.outputs"
                [attr.cx]="output.x"
                [attr.cy]="output.y"
                r="3"
                fill="white"
                stroke="black"
                class="gate-port output-port"
                [attr.data-port-id]="output.id"
                (click)="startWire(gate, output, $event)">
        </circle>

        <text [attr.x]="20" [attr.y]="50" text-anchor="middle" fill="black" font-size="10">{{ gate.type }} ({{ gate.id }})</text>
      </g>

      <!-- Render existing wires -->
      <ng-container *ngFor="let wire of wires">
        <polyline
            [attr.points]="getPolylinePoints(wire.segments)"
            stroke="blue"
            stroke-width="2"
            fill="none"
            marker-end="url(#arrowhead)"
            (click)="editWireLabel(wire, $event)">
        </polyline>
        <text
            [attr.x]="(wire.segments[0].x + wire.segments[wire.segments.length - 1].x) / 2 + 5"
            [attr.y]="(wire.segments[0].y + wire.segments[wire.segments.length - 1].y) / 2 - 5"
            fill="black"
            font-size="10"
            class="wire-label"
            (click)="editWireLabel(wire, $event)">
          {{ wire.label }}
        </text>
      </ng-container>

      <!-- Render temporary wire being drawn -->
      <polyline *ngIf="drawingWire"
            [attr.points]="getPolylinePoints(drawingWire.segments)"
            stroke="gray"
            stroke-width="2"
            fill="none"
            stroke-dasharray="5,5">
      </polyline>

      <!-- Define arrowhead marker for wires -->
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7"
                refX="0" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="blue" />
        </marker>
      </defs>
    </svg>
  </div>

  <!-- Wire Label Editor (moved outside canvas-area) -->
  <div *ngIf="editingWire"
       class="wire-label-editor"
       [style.left.px]="editingWirePosition.x"
       [style.top.px]="editingWirePosition.y">
    <input [(ngModel)]="editingWireLabel"
           (keyup.enter)="saveWireLabel()"
           (keyup.escape)="cancelEditWireLabel()"
           (blur)="saveWireLabel()"
           #labelInput>
  </div>
</div>
