{"version":3,"file":"falstad-circuit.js","sources":["../../../../../components/falstad-circuit.ts"],"sourcesContent":["import { html, css, LitElement, PropertyValues } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\n\nconst _globalCIrcuitJS1: { [key: string]: any } = {};\n\n@customElement('falstad-circuit')\nexport class FalstadCircuit extends LitElement {\n  @property() src: string = '';\n  @property() height: number = 600;\n  @property() uuid = (100000.0 * Math.random()).toFixed(0);\n  @property() autorun: boolean = false;\n\n  static styles = css`\n:host, div, object {\n    position: relative;\n    display: block;\n    width: 100%;\n    height: 100%;\n  }\n\n  .focus-overlay {\n    z-index: 10;\n    user-select: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    pointer-events: initial;\n    background: transparent;\n    contain: paint;\n  }\n\n  .focus-overlay.has-focus {\n    z-index: -10;\n    pointer-events: none;\n  }\n\n  .focus-overlay .bg {\n    background: var(--focus-overlay-bg);\n    opacity: 0;\n    transition: opacity var(--transition-time-short);\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n\n  .focus-overlay:hover .bg {\n    opacity: var(--focus-overlay-opacity);\n  }\n\n  .focus-overlay.has-focus .bg {\n    opacity: 0;\n  }\n\n  .focus-overlay .fg {\n    position: absolute;\n    font-size: 1.5rem;\n    color: var(--focus-overlay-fg);\n    text-shadow: rgba(0, 0, 0, 0.5) 0px 0px 15px;\n    opacity: 0;\n    pointer-events: none;\n    display: flex;\n    align-items: center;\njustify-content: center;\nbackground-color: #000;\n}\n\n  .focus-overlay:hover .fg {\n    opacity: 0.7;\n  }\n\n  .focus-overlay.has-focus .fg {\n    opacity: 0;\n  }\n`;\n\n  constructor() {\n    super();\n    document.addEventListener(\"click\", (clickEvent) => this.handleClick(clickEvent));\n  }\n\n  handleClick(clickEvent: Event) {\n    const overlay = this.renderRoot.querySelector(\".focus-overlay\");\n    if (clickEvent.composedPath().includes(this)) {\n      overlay?.classList.add(\"has-focus\");\n    } else {\n      overlay?.classList.remove(\"has-focus\");\n    }\n  }\n\n  setupIframe() {\n    const iframe = this.shadowRoot?.querySelector(`#circuitFrame-${this.uuid}`) as HTMLIFrameElement | null;\n\n    const self = this;\n    Object.defineProperty(iframe?.contentWindow, 'CircuitJS1', {\n      get: function() {\n        return _globalCIrcuitJS1[self.uuid];\n      },\n\n      set: function(sim) {\n        if (_globalCIrcuitJS1[self.uuid] !== sim) {\n          _globalCIrcuitJS1[self.uuid] = sim;\n        }\n\n        setTimeout(() => {\n          sim.setSimRunning(self.autorun);\n        });\n      }\n    });\n  }\n\n  render() {\n    const remoteURL = new URL(this.src);\n    const params = remoteURL.search;\n    const localOrigin = window.location.origin;\n    const localURL = new URL(`${localOrigin}/js/circuitjs/circuitjs.html${params}`);\n\n    return html`\n<iframe id=\"circuitFrame-${this.uuid}\" src=\"${localURL}\" frameborder=\"0\" style=\"width:100%;height:${this.height}px\" @load=\"${this.setupIframe}\"></iframe>\n<div class=\"focus-overlay\">\n  <div class=\"bg\"></div>\n  <div class=\"fg\">Click or tap to interact</div>\n</div>\n`;\n  }\n}\n"],"names":["LitElement","css","html","property","customElement"],"mappings":"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"}